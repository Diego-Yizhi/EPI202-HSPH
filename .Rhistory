age>=15 & age<=18 ~ 2,
age>18 ~ 3
)) %>% select(female_cat, age_cat) %>%
chisq_test()
t.test(age~female,data = dat_new) %>% tidy()
dat_new %>%
mutate(age_cat = case_when(
age<15 ~ 1,
age>=15 & age<=18 ~ 2,
age>18 ~ 3
)) %>%
table1(~age_cat+age | female)
dat_new %>%
mutate(age_cat = case_when(
age<15 ~ 1,
age>=15 & age<=18 ~ 2,
age>18 ~ 3
)) %>% tableone::CreateTableOne(vars = c(age, age_cat),
strata = female,
factorVars = "age_cat")
head(dat_new)
#Load packages
pacman::p_load(tidyverse, patchwork, ggsignif,
gtsummary, janitor, rstatix,
scales, flextable, here,rio)
#Source the epicalc package- set this to the file path where you saved the epicalc_v3 file
source(here("code","epicalc_v3.R"))
# source("code/epicalc_v3.R")
#Load data
# evansData<-rio::import("data/evans_example_dat.csv", header=T)
mi_onset_10 <- import(here("data","MI_Onset_10.rdata"))
glimpse(mi_onset_10)
skimr::skim(mi_onset_10)
mi_onset_10 <- mi_onset_10 %>% mutate(sedendm = case_when(
phys_activity==0 & dm==1 ~ 1,
phys_activity!=0 & dm==1 ~ 2,
phys_activity==0 & dm!=1 ~ 3,
phys_activity!=0 & dm!=1 ~ 4
))
# adjust factor variables
fac_vars <- names(mi_onset_10)[c(1,3:10,12:14)]
mi_onset_10[fac_vars] <- lapply(mi_onset_10[fac_vars],factor)
mi_onset_10_cat <- mi_onset_10 %>%
mutate(age_cat = fct_recode(age_cat,
"<50yrs"="1","50-64yrs"="2","65+yrs"="3"),
female_cat=fct_recode(female,"F"="1","M"="0"),
married_cat=fct_recode(married, "yes"="1","no"="0"),
educ_cat=fct_recode(educ,"<HS"="1","HS"="2",">HS"="3"),
dm_cat=fct_recode(dm,"yes"="1","no"="0"),
htn_cat=fct_recode(htn,"yes"="1","no"="0"),
phys_cat=fct_recode(phys_activity,"<1/wk"="0","1-3/wk"="1","4+/wk"="2"),
evermarj_cat=fct_recode(evermarj,"yes"="1","no"="0"),
dead_cat=fct_recode(dead,"yes"="1","no"="0"),
cvdeath_cat=fct_recode(cvdeath,"CVD death"="1","not CVD death"="0"),
sedentary = fct_recode(phys_activity, "yes"="0", "no"="1","no"="2"),
sedendm_cat = fct_recode(sedendm, "sedentary and diabetes"="1",
"no sedentary and diabetes"="2", "sedentary and no diabetes"="3",
"no sedentary and no diabetes"="4")
) %>%
mutate(dead_cat = fct_rev(dead_cat),
sedentary = fct_rev(sedentary),
sedendm_cat = fct_rev(sedendm_cat))
# 3 A3 ---------------------------------------------------------------------------------------------------------------
# descriptive table
mi_onset_10_cat %>%
select(age, age_cat, female_cat, married_cat,
educ_cat, dm_cat, htn_cat, sedentary) %>%
tbl_summary(
by = sedentary,
statistic = list(all_continuous() ~ "{mean} ({sd})",
all_categorical() ~ "{n} ({p}%)"),
digits = all_continuous() ~ 3,
type = all_categorical() ~ "categorical",
label = list(
sedentary ~ "Sendentary",
age ~ "Age (years)",
age_cat ~ "Age category",
female_cat ~ "Gender",
married_cat ~ "Marrige status",
educ_cat ~ "Education level",
dm_cat ~ "Diabetes",
htn_cat ~ "Hypertension"
)
) %>% add_p()
#Load packages
pacman::p_load(tidyverse, patchwork, ggsignif,
gtsummary, janitor, rstatix,
scales, flextable, here,rio,table1)
#Source the epicalc package- set this to the file path where you saved the epicalc_v3 file
source(here("code","epicalc_v3.R"))
# source("code/epicalc_v3.R")
#Load data
# evansData<-rio::import("data/evans_example_dat.csv", header=T)
dat <- import(here("data","HeightWeight.rdata"))
glimpse(dat)
skimr::skim(dat)
dat <- dat %>%
mutate(female_cat = factor(female,
levels = c(0,1),
labels = c("Male","Female")))
# 2 height vs age
dat %>%
ggplot(aes(x=age, y=height))+
geom_point()
# 3 delete outliers
dat_new <- dat %>%
filter(age <= 21)
#Load packages
pacman::p_load(tidyverse, patchwork, ggsignif,
gtsummary, janitor, rstatix,
scales, flextable, here,rio,tableone)
#Source the epicalc package- set this to the file path where you saved the epicalc_v3 file
source(here("code","epicalc_v3.R"))
#Load data
# evansData<-rio::import("data/evans_example_dat.csv", header=T)
dat <- import(here("data","HeightWeight.rdata"))
glimpse(dat)
skimr::skim(dat)
dat <- dat %>%
mutate(female_cat = factor(female,
levels = c(0,1),
labels = c("Male","Female")))
# 3 delete outliers
dat_new <- dat %>%
filter(age <= 21)
dat_new <- dat_new %>% mutate(age_cat = case_when(
age<15 ~ 1,
age>=15 & age<=18 ~ 2,
age>18 ~ 3
))
table1 <- CreateTableOne(vars = vars,
strata = "female",
factorVars = "age_cat",
includeNA = T)
table1 <- CreateTableOne(data = dat_new,
vars = vars,
strata = "female",
factorVars = "age_cat",
includeNA = T)
vars <- c("age", "age_cat")
dat_new <- dat_new %>% mutate(age_cat = case_when(
age<15 ~ 1,
age>=15 & age<=18 ~ 2,
age>18 ~ 3
))
table1 <- CreateTableOne(data = dat_new,
vars = vars,
strata = "female",
factorVars = "age_cat",
includeNA = T)
table1 <- print(table1, showAllLevels = TRUE)
write_csv(table1, file = "height by gender.csv")
write.csv(table1, file = "height by gender.csv")
write.csv(table1, file = "data/height by gender.csv")
#Load packages
pacman::p_load(tidyverse, patchwork, ggsignif,
gtsummary, janitor, rstatix,
scales, flextable, here,rio,tableone)
#Source the epicalc package- set this to the file path where you saved the epicalc_v3 file
source(here("code","epicalc_v3.R"))
# source("code/epicalc_v3.R")
#Load data
# evansData<-rio::import("data/evans_example_dat.csv", header=T)
dat <- import(here("data","HeightWeight.rdata"))
glimpse(dat)
skimr::skim(dat)
dat <- dat %>%
mutate(female_cat = factor(female,
levels = c(0,1),
labels = c("Male","Female")))
# 3 delete outliers
dat_new <- dat %>%
filter(age <= 21)
dat_new <- dat_new %>% mutate(age_cat = case_when(
age<15 ~ 1,
age>=15 & age<=18 ~ 2,
age>18 ~ 3
))
vars <- c("age", "age_cat")
table1 <- CreateTableOne(data = dat_new,
vars = vars,
strata = "female",
factorVars = "age_cat",
includeNA = T)
table1 <- print(table1, showAllLevels = TRUE)
table1 <- print(table1[-1], showAllLevels = TRUE)
table1 <- CreateTableOne(data = dat_new,
vars = vars,
strata = "female",
factorVars = "age_cat",
includeNA = T,
addOverall = T)
table1 <- print(table1, showAllLevels = TRUE)
table1 <- CreateTableOne(data = dat_new,
vars = vars,
strata = "female",
factorVars = "age_cat",
includeNA = T
#,addOverall = T
)
table1 <- print(table1, showAllLevels = TRUE)
#Load packages
pacman::p_load(tidyverse, patchwork, ggsignif,
gtsummary, janitor, rstatix,
scales, flextable, here,rio, tableone)
#Source the epicalc package- set this to the file path where you saved the epicalc_v3 file
source(here("code","epicalc_v3.R"))
# source("code/epicalc_v3.R")
#Load data
# evansData<-rio::import("data/evans_example_dat.csv", header=T)
mi_onset_10 <- import(here("data","MI_Onset_10.rdata"))
glimpse(mi_onset_10)
skimr::skim(mi_onset_10)
mi_onset_10 <- mi_onset_10 %>% mutate(sedendm = case_when(
phys_activity==0 & dm==1 ~ 1,
phys_activity!=0 & dm==1 ~ 2,
phys_activity==0 & dm!=1 ~ 3,
phys_activity!=0 & dm!=1 ~ 4
))
# adjust factor variables
fac_vars <- names(mi_onset_10)[c(1,3:10,12:14)]
mi_onset_10[fac_vars] <- lapply(mi_onset_10[fac_vars],factor)
mi_onset_10_cat <- mi_onset_10 %>%
mutate(age_cat = fct_recode(age_cat,
"<50yrs"="1","50-64yrs"="2","65+yrs"="3"),
female_cat=fct_recode(female,"F"="1","M"="0"),
married_cat=fct_recode(married, "yes"="1","no"="0"),
educ_cat=fct_recode(educ,"<HS"="1","HS"="2",">HS"="3"),
dm_cat=fct_recode(dm,"yes"="1","no"="0"),
htn_cat=fct_recode(htn,"yes"="1","no"="0"),
phys_cat=fct_recode(phys_activity,"<1/wk"="0","1-3/wk"="1","4+/wk"="2"),
evermarj_cat=fct_recode(evermarj,"yes"="1","no"="0"),
dead_cat=fct_recode(dead,"yes"="1","no"="0"),
cvdeath_cat=fct_recode(cvdeath,"CVD death"="1","not CVD death"="0"),
sedentary = fct_recode(phys_activity, "yes"="0", "no"="1","no"="2"),
sedendm_cat = fct_recode(sedendm, "sedentary and diabetes"="1",
"no sedentary and diabetes"="2", "sedentary and no diabetes"="3",
"no sedentary and no diabetes"="4")
) %>%
mutate(dead_cat = fct_rev(dead_cat),
sedentary = fct_rev(sedentary),
sedendm_cat = fct_rev(sedendm_cat))
mi_onset_10_cat
names(mi_onset_10_cat)
vars_mi <- names(mi_onset_10_cat)[c(2,3,15:19,24)]
vars_mi
vars_mi <- names(mi_onset_10_cat)[c(2,3,15:19)]
fac_vars_mi <- names(mi_onset_10_cat)[c(3,15:19)]
table1 <- CreateTableOne(vars = vars_mi,
strata = "sedentary",
data = mi_onset_10_cat,
addOverall = T, includeNA = T)
table1_print <- print(table1, showAllLevels = T)
write.csv(table1_print, "A3_tableone.csv")
write.csv(table1_print, "HW/HW3/A3_tableone.csv")
export(table1_print, file = "HW/HW3/A3_tableone.docx")
export(table1_print, file = "HW/HW3/A3_tableone.xls")
export(table1_print, "HW/HW3/A3_tableone.xls")
export(table1_print, "HW/HW3/A3_tableone.xlsx")
export(table1_print, "HW/HW3/A3_tableone.csv")
export(table1_print, "HW/HW3/A3_tableone.xlsx", col.names = F)
export(table1_print, "HW/HW3/A3_tableone.xlsx", colNames = F)
export(table1_print, "HW/HW3/A3_tableone.xlsx", keepNA = T)
table1_print <- print(table1, quote = T ,showAllLevels = T)
export(table1_print, "HW/HW3/A3_tableone.xlsx", keepNA = T)
write.csv(table1_print, "HW/HW3/A3_tableone.csv")
table1_print <- print(table1,showAllLevels = T)
export(table1_print, "HW/HW3/A3_tableone.xlsx", keepNA = T)
export(table1_print, "HW/HW3/A3_tableone.xlsx", row.names = T)
export(table1_print, "HW/HW3/A3_tableone.xlsx", rowNames = T)
table1 <- CreateTableOne(vars = vars_mi,
strata = "sedentary",
data = mi_onset_10_cat,
addOverall = T, includeNA = T)
table1_print <- print(table1,showAllLevels = T)
export(table1_print, "HW/HW3/A3_tableone.xlsx", rowNames = T,
colNames = T)
write.csv(table1_print, "HW/HW3/A3_tableone.csv")
#Load packages
pacman::p_load(tidyverse, patchwork, ggsignif,
gtsummary, janitor, rstatix,
scales, flextable, here,rio,modelsummary)
#Source the epicalc package- set this to the file path where you saved the epicalc_v3 file
source(here("code","epicalc_v3.R"))
#Load data
# evansData<-rio::import("data/evans_example_dat.csv", header=T)
dat <- import(here("data","HeightWeight.rdata"))
glimpse(dat)
skimr::skim(dat)
dat <- dat %>%
mutate(female_cat = factor(female,
levels = c(0,1),
labels = c("Male","Female")))
# 3 delete outliers
dat_new <- dat %>%
filter(age <= 21)
dat_new <- dat_new %>% mutate(age_cat = case_when(
age<15 ~ 1,
age>=15 & age<=18 ~ 2,
age>18 ~ 3
))
datasummary_df(dat_new)
datasummary_balance(~female,
data = dat_new[c("age","age_cat")])
datasummary_balance(~female,
data = dat_new[c("age","age_cat","female")])
install.packages("estimatr")
datasummary_balance(~female,
data = dat_new[c("age","age_cat","female")],
output = "huxtable",
fmt = 3,
dinm_statistic = "p.value")
datasummary_balance(~female,
data = dat_new[c("age","age_cat","female")],
output = "huxtable",
fmt = 3,
stars = T,
dinm_statistic = "p.value")
install.packages("modelsummary",dependencies = T)
install.packages("modelsummary", dependencies = T)
#Load packages
pacman::p_load(tidyverse, patchwork, ggsignif,
gtsummary, janitor, rstatix,
scales, flextable, here,rio,modelsummary)
#Source the epicalc package- set this to the file path where you saved the epicalc_v3 file
source(here("code","epicalc_v3.R"))
#Load data
# evansData<-rio::import("data/evans_example_dat.csv", header=T)
mi_onset_10 <- import(here("data","MI_Onset_10.rdata"))
mi_onset_10 <- mi_onset_10 %>% mutate(sedendm = case_when(
phys_activity==0 & dm==1 ~ 1,
phys_activity!=0 & dm==1 ~ 2,
phys_activity==0 & dm!=1 ~ 3,
phys_activity!=0 & dm!=1 ~ 4
))
# adjust factor variables
fac_vars <- names(mi_onset_10)[c(1,3:10,12:14)]
mi_onset_10[fac_vars] <- lapply(mi_onset_10[fac_vars],factor)
mi_onset_10_cat <- mi_onset_10 %>%
mutate(age_cat = fct_recode(age_cat,
"<50yrs"="1","50-64yrs"="2","65+yrs"="3"),
female_cat=fct_recode(female,"F"="1","M"="0"),
married_cat=fct_recode(married, "yes"="1","no"="0"),
educ_cat=fct_recode(educ,"<HS"="1","HS"="2",">HS"="3"),
dm_cat=fct_recode(dm,"yes"="1","no"="0"),
htn_cat=fct_recode(htn,"yes"="1","no"="0"),
phys_cat=fct_recode(phys_activity,"<1/wk"="0","1-3/wk"="1","4+/wk"="2"),
evermarj_cat=fct_recode(evermarj,"yes"="1","no"="0"),
dead_cat=fct_recode(dead,"yes"="1","no"="0"),
cvdeath_cat=fct_recode(cvdeath,"CVD death"="1","not CVD death"="0"),
sedentary = fct_recode(phys_activity, "yes"="0", "no"="1","no"="2"),
sedendm_cat = fct_recode(sedendm, "sedentary and diabetes"="1",
"no sedentary and diabetes"="2", "sedentary and no diabetes"="3",
"no sedentary and no diabetes"="4")
) %>%
mutate(dead_cat = fct_rev(dead_cat),
sedentary = fct_rev(sedentary),
sedendm_cat = fct_rev(sedendm_cat))
# overview the dataset
datasummary_skim(mi_onset_10_cat)
skimr::skim(mi_onset_10_cat)
glimpse(mi_onset_10_cat)
# overview the dataset
mi_onset_10_cat %>% datasummary(age ~ mean + sd)
# overview the dataset
mi_onset_10_cat %>% datasummary(age ~ mean + sd, data = .)
# overview the dataset
skimr::skim(mi_onset_10_cat)
# 1 2*2 table
mi_onset_10_cat %>%
group_by(dm_cat) %>%
count(cvdeath_cat) %>%
mutate(prop = n/sum(n))
mi_onset_10_cat %>%
gmodels::CrossTable(cvdeath_cat, dm_cat)
gmodels::CrossTable(mi_onset_10_cat$cvdeath_cat, mi_onset_10_cat$dm_cat)
# 1 2*2 table
mi_onset_10_cat %>%
group_by(dm_cat) %>%
count(cvdeath_cat) %>%
mutate(prop = n/sum(n))
OR <- 246*2469/(547*450)
(OR <- 246*2469/(547*450))
# 2. 2*2 table
(crosstable <- mi_onset_10_cat %>%
group_by(dm_cat) %>%
count(cvdeath_cat) %>%
mutate(prop = n/sum(n)))
(OR <- crosstable[4,3])
(OR <- crosstable[4,3]*crosstable[1,3]/(crosstable[2,3]*crosstable[3,3]))
(log_1 %>% tidy(conf.int=T))
# 3. create a logit regre
log_1 <- glm(cvdeath_cat ~ dm_cat,
data = mi_onset_10_cat,
family = binomial(link = "logit"))
(log_1 %>% tidy(conf.int=T))
(log_1 %>% tidy(exponentiate=T,onf.int=T))
(log_1 %>% tidy(exponentiate=T,conf.int=T))
(log_1 %>% tidy(conf.int=T))
(log_1 %>% tidy(exponentiate=T,conf.int=T))
(crosstable <- mi_onset_10_cat %>%
group_by(dm_cat) %>%
count(cvdeath_cat) %>%
mutate(prop = n/sum(n)))
(OR <- crosstable[4,3]*crosstable[1,3]/(crosstable[2,3]*crosstable[3,3]))
# 5 cvdeath~dm+age
log_2 <- glm(cvdeath_cat ~ dm_cat + age,
data = mi_onset_10_cat, family = binomial(link = "logit"))
(log_2 %>%  tidy(conf.int=T))
(log_2 %>% tidy(exponentiate=T, conf.int=T))
# 6 10-year increament
exp(10*(log_2 %>%  tidy(conf.int=T))[3,2])
(log_2 %>%  tidy(conf.int=T))[3,2]
crosstable[4,3]*crosstable[1,3]/(crosstable[2,3]*crosstable[3,3])
glimpse(mi_onset_10_cat)
log_3 <- glm(cvdeath_cat ~ dm_cat+age+htn_cat+female_cat+phys_cat+educ_cat,
data = mi_onset_10_cat,
family = binomial(link = "logit"))
(log_3 %>%  tidy(conf.int=T))
(log_3 %>% tidy(exponentiate=T, conf.int=T))
(log_3 %>%  tidy(conf.int=T, showAllLevels = T))
modelsummary(log_3)
bruceR::model_summary(log_3)
bruceR::model_summary(exp(log_3))
bruceR::model_summary(list(log_1, log_2, log_3))
bruceR::model_summary(list(log_1, log_2, log_3),
exponentiate = T)
modelsummary(list(log_1, log_2, log_3),
exponentiate = T)
modelsummary(list(log_1, log_2, log_3),
exponentiate = T,
stars = T)
modelsummary(list(log_1, log_2, log_3),
exponentiate = T,
stars = T,
output = "huxtable")
modelsummary(list(log_1, log_2, log_3),
exponentiate = T,
stars = T,
output = "huxtable") %>%
export("text.docx")
modelsummary(list(log_1, log_2, log_3),
exponentiate = T,
stars = T,
output = "huxtable") %>%
export()
modelsummary(list(log_1, log_2, log_3),
exponentiate = T,
stars = T,
output = "huxtable") %>%
export("text.csv")
modelsummary(list(log_1, log_2, log_3),
exponentiate = T,
stars = T,
output = "huxtable") %>%
export("regression.csv", colNames = T)
modelsummary(list(log_1, log_2, log_3),
exponentiate = T,
stars = T,
output = "huxtable")
%>%
modelsummary(list(log_1, log_2, log_3),
exponentiate = T,
stars = T,
output = "huxtable") %>%
export("regression.csv")
modelsummary(list(log_1, log_2, log_3),
exponentiate = T,
stars = T,
output = "huxtable") %>%
export("regression.docx")
modelsummary(list(log_1, log_2, log_3),
exponentiate = T,
stars = T,
output = "huxtable") %>%
export("regression.xlsx")
modelsummary(list(log_1, log_2, log_3),
exponentiate = T,
stars = T,
output = "huxtable") %>%
export("weekly materials/6 Logistic regression/regression.xlsx")
# 8 htn*dm
log_4 <- glm(cvdeath_cat ~ dm_cat*htn_cat+age+female_cat+phys_cat+educ_cat,
data = mi_onset_10_cat,
family = binomial(link = "logit"))
modelsummary(list(log_3, log_4),
exponentiate = T, stars = T,output = "huxtable")
modelsummary(list(log_3, log_4),
estimate  = "{estimate} [{conf.low}, {conf.high}]",
exponentiate = T, stars = T,output = "huxtable")
modelsummary(list(log_3, log_4),
estimate  = "{estimate} [{conf.low}, {conf.high}]",
statistic = NULL,
exponentiate = T, stars = T,output = "huxtable")
modelsummary(list(log_3, log_4),
estimate  = "{estimate} ({conf.low}, {conf.high})",
statistic = NULL,
exponentiate = T,,output = "huxtable")
modelsummary(list(log_3, log_4),
estimate  = "{estimate} ({conf.low}, {conf.high})",
statistic = NULL,output = "huxtable")
exp(0.634-0.812)
exp(1.238-0.033)
1.884*0.444
3.449*0.968
modelsummary(list(log_3, log_4),
estimate  = "{estimate} ({conf.low}, {conf.high})",
statistic = NULL,
exponentiate = T,output = "huxtable")
exp(1.884*0.444)
1.884*0.444
3.449*0.968
